---
title: "API Authentication"
description: "Authentication and authorization for FastSkill HTTP API including JWT tokens and role-based access control."
---

## Overview

FastSkill HTTP API uses JWT (JSON Web Tokens) for authentication and role-based access control (RBAC). Authentication is required for most operations, with different roles having different permission levels.

<Info>
JWT tokens are generated by the `/auth/token` endpoint and must be included in the `Authorization` header as `Bearer <token>`.
</Info>

<Info>
The API enforces authentication by default: only allowlisted public routes (e.g., `POST /auth/token`, `GET /`, `GET /api/status`, dashboard and static assets) are unauthenticated; all other routes require a valid JWT and return 401 if missing or invalid.
</Info>

## Authentication Flow

### 1. Get Token

Authenticate with the registry to receive a JWT token.

**Endpoint**: `POST /auth/token`

**Request Body**:

```json
{
  "role": "manager",
  "username": "optional-username"
}
```

**Fields**:

| Field | Type | Required | Description |
|-------|--------|-----------|-------------|
| `role` | string | Yes | User role (`user`, `manager`, or `admin`) |
| `username` | string | No | Optional username for tracking purposes |

**Example**:
```bash
# Generate token as manager
curl -X POST http://localhost:8080/auth/token \
  -H "Content-Type: application/json" \
  -d '{
    "role": "manager",
    "username": "dev-user"
  }'

# Generate token as admin
curl -X POST http://localhost:8080/auth/token \
  -H "Content-Type: application/json" \
  -d '{
    "role": "admin"
  }'
```

**Response**:
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhY21lL2FsaWNlIiwicm9sZSI6Im1hbmFnZXIiLCJleHAiOjE3MDk4MzAwMDAsImlhdCI6MTcwNzI0MjQwMH0.signature",
    "expires_at": "2025-02-15T10:30:00Z",
    "role": "manager"
  }
}
```

### 2. Use Token

Include the JWT token in the `Authorization` header for all subsequent requests.

```bash
# Use token in request
curl -X GET http://localhost:8080/api/skills \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# Set token as environment variable for convenience
export TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
curl -X GET http://localhost:8080/api/skills \
  -H "Authorization: Bearer $TOKEN"
```

### 3. Verify Token (Optional)

Verify that a token is valid and retrieve user information.

**Endpoint**: `GET /auth/verify`

**Headers**:
- `Authorization: Bearer <token>`

**Example**:
```bash
curl -X GET http://localhost:8080/auth/verify \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

**Response** (valid token):
```json
{
  "success": true,
  "data": {
    "valid": true,
    "user": "acme/alice",
    "role": "manager",
    "scope": "acme",
    "expires_at": "2025-02-15T10:30:00Z"
  }
}
```

**Response** (invalid token):
```json
{
  "success": false,
  "error": {
    "code": "INVALID_TOKEN",
    "message": "Invalid or expired token"
  }
}
```

## Role-Based Access Control (RBAC)

FastSkill implements a three-tier role hierarchy:

### Role Hierarchy

```
admin
  └─ manager
       └─ user
```

- **admin**: Full access to all operations including user management and registry configuration
- **manager**: Can publish, update, and delete skills; view registry metrics
- **user**: Read-only access to skills and search functionality

### Permission Matrix

| Operation | user | manager | admin |
|-----------|-------|---------|--------|
| **Read Operations** |
| List skills | ✓ | ✓ | ✓ |
| Get skill details | ✓ | ✓ | ✓ |
| Search skills | ✓ | ✓ | ✓ |
| Get skill versions | ✓ | ✓ | ✓ |
| **Write Operations** |
| Create skills | ✗ | ✓ | ✓ |
| Update skills | ✗ | ✓ | ✓ |
| Delete skills | ✗ | ✓ | ✓ |
| Create skill versions | ✗ | ✓ | ✓ |
| Delete skill versions | ✗ | ✓ | ✓ |
| Enable/disable skills | ✗ | ✓ | ✓ |
| **Registry Operations** |
| Publish to registry | ✗ | ✓ | ✓ |
| Update manifest | ✗ | ✓ | ✓ |
| View registry metrics | ✗ | ✓ | ✓ |
| **Admin Operations** |
| Manage users | ✗ | ✗ | ✓ |
| Configure registry | ✗ | ✗ | ✓ |
| View all registry data | ✗ | ✗ | ✓ |

### Scope-Based Authorization

When a user authenticates, their token includes a `scope` claim that determines which skills they can publish:

```json
{
  "sub": "acme/alice",
  "scope": "acme",
  "role": "manager"
}
```

**Scope Examples**:

| User (sub) | Scope | Can Publish To |
|-------------|--------|----------------|
| `acme/alice` | `acme` | `acme/*` skills |
| `personal` | `personal` | `personal/*` skills |
| `company/dev-team/bob` | `company` | `company/*` skills |

**Publishing with Scopes**:

When publishing skills, the server automatically prepends the scope to the skill ID:

```bash
# User: acme/alice (scope: acme)
# Publish skill with name: web-scraper
# Result: skill published as "acme/web-scraper"
```

## API Key Authentication

For service-to-service integration, FastSkill supports API key authentication.

**Header**: `x-api-key: <api-key>`

```bash
curl -X GET http://localhost:8080/api/skills \
  -H "x-api-key: your-api-key-here"
```

<Warning>
API keys are typically generated through the registry admin interface or configuration. API keys may have different permissions than JWT tokens.
</Warning>

### API Key vs JWT Token

| Feature | API Key | JWT Token |
|----------|-----------|-------------|
| **Authentication** | Header `x-api-key` | Header `Authorization: Bearer` |
| **Expiration** | Never expires (unless revoked) | Typically expires in 24 hours |
| **User Context** | No user context | Includes user, role, and scope |
| **Revocation** | Can be revoked in admin panel | Can be revoked by logout |
| **Use Case** | Service accounts, CI/CD | User sessions, interactive use |

## Token Management

### Token Expiration

JWT tokens have a configurable expiration time (default: 24 hours). After expiration:

```bash
# Token expired response
{
  "success": false,
  "error": {
    "code": "INVALID_TOKEN",
    "message": "Token has expired"
  }
}
```

**Solution**: Generate a new token:
```bash
curl -X POST http://localhost:8080/auth/token \
  -H "Content-Type: application/json" \
  -d '{"role": "manager"}'
```

### Token Refresh

FastSkill CLI automatically manages token refresh when needed:

```bash
# CLI automatically checks token expiration
fastskill auth whoami

# If expired, re-authenticate
fastskill auth login --role manager
```

### Token Storage

Tokens are stored locally for reuse:

- **CLI**: Stored in `~/.fastskill/auth.toml`
- **HTTP Clients**: Store in application configuration or environment variables

**Example storage format**:
```toml
[[registries]]
registry_url = "https://registry.example.com"
username = "dev-user"
role = "manager"
token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
expires_at = "2025-02-15T10:30:00Z"
last_refresh = "2025-01-15T10:30:00Z"
```

<Warning>
Never commit `auth.toml` or tokens to version control. Rotate tokens regularly for security.
</Warning>

## Using Authentication in Different Scenarios

### Interactive CLI

```bash
# Login once
fastskill auth login --role manager

# Token stored automatically
# All subsequent commands use the token
fastskill list
fastskill search "query"
fastskill publish --artifacts ./artifacts/pptx-1.2.3.zip
```

### Shell Scripts

```bash
#!/bin/bash

# 1. Get token
TOKEN=$(curl -s -X POST http://localhost:8080/auth/token \
  -H "Content-Type: application/json" \
  -d '{"role": "manager"}' | jq -r '.data.token')

# 2. Use token in requests
curl -X GET http://localhost:8080/api/skills \
  -H "Authorization: Bearer $TOKEN"

# 3. Create skill
curl -X POST http://localhost:8080/api/code/v1/skills \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "my-skill",
    "name": "My Skill",
    "description": "Description",
    "version": "1.0.0"
  }'
```

### Web Applications (JavaScript)

```javascript
// Fetch token
const response = await fetch('http://localhost:8080/auth/token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    role: 'manager',
    username: 'web-user'
  })
});

const { data } = await response.json();
const token = data.token;

// Store token (e.g., localStorage)
localStorage.setItem('fastskill_token', token);

// Use token in requests
const skillsResponse = await fetch('http://localhost:8080/api/skills', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

### Python Requests

```python
import requests

# Get token
response = requests.post(
    'http://localhost:8080/auth/token',
    json={'role': 'manager', 'username': 'python-user'}
)
data = response.json()
token = data['data']['token']

# Use token in requests
headers = {'Authorization': f'Bearer {token}'}
skills_response = requests.get(
    'http://localhost:8080/api/skills',
    headers=headers
)
skills = skills_response.json()
```

## Error Handling

### Common Authentication Errors

#### 401 Unauthorized

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Missing or invalid authentication token"
  }
}
```

**Causes**:
- No `Authorization` header provided
- Invalid token format
- Expired token

**Solutions**:
- Check `Authorization` header format
- Generate a new token
- Verify token isn't truncated

#### 403 Forbidden

```json
{
  "success": false,
  "error": {
    "code": "FORBIDDEN",
    "message": "Insufficient permissions for this operation"
  }
}
```

**Causes**:
- User role insufficient for operation
- User doesn't have access to requested scope

**Solutions**:
- Authenticate with higher role (`manager` or `admin`)
- Verify scope matches target skill
- Contact registry administrator

#### 409 Conflict (Scope Issues)

```json
{
  "success": false,
  "error": {
    "code": "CONFLICT",
    "message": "Skill ID already exists in this scope"
  }
}
```

**Causes**:
- Attempting to publish skill that already exists in scope
- Another user in same scope has same skill name

**Solutions**:
- Choose a different skill name
- Coordinate with team members
- Update existing skill instead of creating new one

## Security Best Practices

<Steps>
<Step title="Use HTTPS">
Always use HTTPS for authentication and API requests:
```bash
# Good
curl https://registry.example.com/auth/token

# Bad - insecure
curl http://registry.example.com/auth/token
```
</Step>

<Step title="Protect Tokens">
Never expose tokens in:
- URL parameters
- Client-side JavaScript (except in secure sessionStorage)
- Version control
- Logs or error messages
- Public documentation
</Step>

<Step title="Rotate Tokens">
Regularly rotate JWT tokens:
- Logout and re-authenticate periodically
- Use short expiration times for high-risk environments
- Revoke compromised tokens immediately
</Step>

<Step title="Use Appropriate Roles">
Assign minimal required role:
- Use `user` for read-only applications
- Use `manager` for publishing workflows
- Use `admin` only for administration
</Step>

<Step title="Store Tokens Securely">
- Use secure storage mechanisms (keychain, secret managers)
- Restrict file permissions on token storage files
- Never hardcode tokens in source code
- Use environment variables for CI/CD
</Step>
</Steps>

## CI/CD Integration

### GitHub Actions

```yaml
name: Publish Skill
on:
  push:
    branches: [main]

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Authenticate
        id: auth
        run: |
          TOKEN=$(curl -s -X POST ${{ secrets.REGISTRY_URL }}/auth/token \
            -H "Content-Type: application/json" \
            -d '{"role": "manager"}' | jq -r '.data.token')
          echo "token=$TOKEN" >> $GITHUB_OUTPUT
        env:
          REGISTRY_URL: ${{ secrets.REGISTRY_URL }}
      
      - name: Publish skill
        run: |
          curl -X POST ${{ secrets.REGISTRY_URL }}/api/code/v1/skills \
            -H "Authorization: Bearer ${{ steps.auth.outputs.token }}" \
            -H "Content-Type: application/json" \
            -d @skill.json
```

### GitLab CI

```yaml
publish:
  script:
    - |
      # Get token
      TOKEN=$(curl -s -X POST $REGISTRY_URL/auth/token \
        -H "Content-Type: application/json" \
        -d '{"role": "manager"}' | jq -r '.data.token')
      
      # Publish skill
      curl -X POST $REGISTRY_URL/api/code/v1/skills \
        -H "Authorization: Bearer $TOKEN" \
        -H "Content-Type: application/json" \
        -d @skill.json
  variables:
    REGISTRY_URL: https://registry.example.com
```

## Troubleshooting

<AccordionGroup>
<Accordion title="Token expired immediately">
  <Warning>
  **Check server time**: Ensure server and client clocks are synchronized. JWT expiration uses server time.
  ```bash
  # Check server time
  curl http://localhost:8080/api/status
  ```
  </Warning>
</Accordion>

<Accordion title="Token not working">
  <Tip>
  **Verify header format**: Ensure `Authorization: Bearer <token>` format (with space after "Bearer").
  ```bash
  # Correct
  curl -H "Authorization: Bearer $TOKEN"
  
  # Incorrect (missing space)
  curl -H "Authorization:Bearer $TOKEN"
  ```
  </Tip>
</Accordion>

<Accordion title="Insufficient permissions">
  <Warning>
  **Check role**: Verify your role has permissions for the operation.
  ```bash
  # Verify your role
  curl -H "Authorization: Bearer $TOKEN" \
    http://localhost:8080/auth/verify
  
  # Re-authenticate with higher role if needed
  fastskill auth login --role admin
  ```
  </Warning>
</Accordion>
</AccordionGroup>

## See Also

- [CLI Auth Command](/cli-reference/auth-command) - CLI authentication
- [Claude Code v1 API](/api-reference/claude-code-v1-api) - v1 API endpoints
- [API Reference Overview](/api-reference/overview) - General API information
- [Registry Overview](/registry/overview) - Registry management
