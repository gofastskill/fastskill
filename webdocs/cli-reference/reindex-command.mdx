---
title: "Reindex Command"
description: "Index skills with embeddings for semantic search capabilities."
---

## Overview

The `reindex` command scans skill directories, extracts metadata from SKILL.md files, generates embeddings using OpenAI's API, and builds a local vector index for semantic search.

<Info>
This command requires OpenAI API configuration and will create a local SQLite database to store embeddings.
</Info>

## Basic Usage

```bash
fastskill reindex --skills-dir /path/to/skills/
```

## Command Options

### --skills-dir <DIRECTORY>

**Required.** Specifies the root directory containing SKILL.md files.

```bash
# Index skills from Claude directory
fastskill reindex --skills-dir .claude/skills/

# Index from custom location
fastskill reindex --skills-dir ./my-skills/
```

### --force

Force re-indexing of all skills, even if they haven't changed.

```bash
# Rebuild entire index
fastskill reindex --skills-dir .claude/skills/ --force
```

**Use Cases:**
- After significant content changes
- When embeddings seem outdated
- To rebuild corrupted index

### --max-concurrent <NUMBER>

Control the number of concurrent embedding API requests (default: 5).

```bash
# Increase concurrency for faster indexing
fastskill reindex --skills-dir .claude/skills/ --max-concurrent 10

# Reduce concurrency to avoid rate limits
fastskill reindex --skills-dir .claude/skills/ --max-concurrent 2
```

## Configuration Requirements

### 1. FastSkill Configuration

Create `.fastskill/config.yaml` with embedding settings:

```yaml
embedding:
  openai_base_url: "https://api.openai.com/v1"
  embedding_model: "text-embedding-3-small"
```

### 2. OpenAI API Key

Set the environment variable:

```bash
export OPENAI_API_KEY="sk-your-actual-api-key"
```

## What Happens During Reindex

### 1. Directory Scanning

The command recursively searches for `SKILL.md` files:

```
.claude/skills/
├── dataops/
│   ├── airflow-ops/
│   │   └── SKILL.md
│   └── dag-development/
│       └── SKILL.md
├── infra/
│   ├── k8s-monitoring/
│   │   └── SKILL.md
│   └── k8s-ops/
│       └── SKILL.md
└── product-management/
    └── backlog/
        └── SKILL.md
```

### 2. Content Extraction

For each SKILL.md file:
- Parses YAML frontmatter
- Extracts metadata (name, description, tags, capabilities)
- Calculates file hash for change detection

### 3. Embedding Generation

- Sends content to OpenAI embedding API
- Stores resulting vectors locally
- Handles API rate limits and errors gracefully

### 4. Index Building

- Creates/updates SQLite database
- Stores metadata, embeddings, and file hashes
- Creates optimized indexes for fast search

### 5. Cleanup

- Removes index entries for skills no longer on disk
- Compares indexed skill IDs with current skill directories
- Logs removal of stale entries (does not fail reindex)

## Progress Monitoring

### Output Levels

The reindex command supports three output levels:

- **Default**: Shows progress bar with completion percentage
- **Verbose (`-v, --verbose`)**: Shows per-skill processing details
- **Quiet (`-q, --quiet`)**: Suppresses progress, shows only final summary

### Progress Bar

By default, reindex displays a live progress bar:

```
Progress: [12/50] (24%) | Pending: 38 | Skipped: 0 | Failed: 0 | Elapsed: 15s
```

The progress bar shows:
- Number of completed skills
- Completion percentage
- Remaining skills to process
- Skills skipped (unchanged)
- Skills that failed
- Total elapsed time

### Verbose Mode

Use `-v` or `--verbose` to see detailed output:

```bash
fastskill reindex --verbose

Processing: pptx
Processing: skill-creator
  ⊘ Skipped: fastskill (unchanged hash)
Processing: pptx
  ✗ Failed: bad-skill - Failed to parse frontmatter
  ✓ Indexed: data-ops
...
Reindex completed
  Total skills: 50
  Successfully indexed: 42
  Skipped (unchanged): 5
  Failed: 3
  Total time: 45.23s
```

### Quiet Mode

Use `-q` or `--quiet` to suppress all progress output:

```bash
fastskill reindex --quiet

Reindex completed
  Total skills: 50
  Successfully indexed: 42
  Skipped (unchanged): 5
  Failed: 3
  Total time: 45.23s
```

### Environment Variables

The reindex command respects the following environment variables:

#### `FASTSKILL_NO_PROGRESS`

Disable progress bars and spinners:

```bash
FASTSKILL_NO_PROGRESS=1 fastskill reindex
```

This is useful when running in non-interactive environments like CI/CD pipelines.

#### `NO_COLOR`

Disable colored output:

```bash
NO_COLOR=1 fastskill reindex
```

Useful for environments that don't support ANSI color codes.

### TTY Detection

The progress bar automatically detects if stdout is a TTY:
- **TTY terminal**: Shows progress bar (unless `FASTSKILL_NO_PROGRESS` is set)
- **Piped output**: No progress bar (falls back to simple text)
- **Redirected output**: No progress bar

Examples:
```bash
# Shows progress bar (TTY)
fastskill reindex --skills-dir .claude/skills/

# No progress bar (piped to grep)
fastskill reindex --skills-dir .claude/skills/ | grep "error"

# No progress bar (redirected to file)
fastskill reindex --skills-dir .claude/skills/ > output.log

# Force quiet mode explicitly
fastskill reindex --quiet
```

## Output and Progress

### Legacy Output (Logging)

In addition to the progress monitoring, the command uses structured logging:

```
INFO Processing skill: airflow-ops
INFO Processing skill: dag-development
INFO Processing skill: k8s-monitoring
```

This logging is separate from the user-facing progress output and can be controlled via the `RUST_LOG` environment variable for debugging purposes.

### Success Output

When using default or verbose mode, you'll see detailed progress information followed by a summary:

### Error Handling

In verbose mode, errors are shown with detailed information:

```
  ✗ Failed: airflow-ops - Failed to generate embedding: OpenAI API error 401 Unauthorized
  ✗ Failed: dag-development - Failed to parse frontmatter: Invalid YAML
...
Reindex completed
  Total skills: 15
  Successfully indexed: 13
  Skipped (unchanged): 0
  Failed: 2
  Total time: 23.45s

error: Reindex completed with 2 errors
```

In quiet or default mode, only the summary and error count are shown.

Common errors:
- **API Key Issues**: Check `OPENAI_API_KEY` environment variable
- **Rate Limits**: Reduce `--max-concurrent` or wait before retrying
- **Network Issues**: Check internet connectivity
- **Permission Issues**: Ensure write access to skills directory

## Database Location

The vector index is stored in the skills directory:

```
.claude/skills/
└── .fastskill/
    └── index.db
```

**File Details:**
- **Format**: SQLite database
- **Size**: ~1-10MB depending on number of skills
- **Content**: Metadata, embeddings, file hashes, timestamps

## Performance Considerations

### Indexing Time

- **Small repositories**: < 1 minute
- **Medium repositories** (100 skills): 2-5 minutes
- **Large repositories** (1000+ skills): 10-30 minutes

### Cost Estimation

- **text-embedding-3-small**: ~$0.02 per 1M tokens
- **Average skill**: ~500 tokens
- **100 skills**: ~$0.001 (less than 1 cent)

### Optimization Tips

```bash
# Use smaller batches for rate limit avoidance
fastskill reindex --max-concurrent 2

# Index only changed skills (default behavior)
fastskill reindex --skills-dir .claude/skills/

# Force full rebuild only when necessary
fastskill reindex --force
```

## Incremental Updates

The reindex command is intelligent about updates:

### Change Detection
- Calculates SHA256 hash of each SKILL.md file
- Only re-embeds files that have changed
- Preserves existing embeddings for unchanged files

### Example Workflow
```bash
# Initial indexing
fastskill reindex --skills-dir .claude/skills/
# Indexes all 15 skills

# Add one new skill
# Only the new skill gets indexed
fastskill reindex --skills-dir .claude/skills/
# Indexes 1 skill (the new one)
```

## Integration Features

### Cursor Integration

When reindex completes, it can optionally generate a markdown file for Cursor:

```bash
fastskill reindex --skills-dir .claude/skills/
# Creates: .claude/skills/.fastskill/skills.md
```

This file contains all indexed skills in markdown format. To expose installed skills to Cursor and other agents, use `fastskill sync` to update AGENTS.md instead.

### Configuration for Markdown Export

Add to `.fastskill/config.yaml`:

```yaml
markdown_export:
  enabled: true
  output_path: "docs/skills-registry.md"
  header_instructions: |
    Skills are modular packages in `.claude/skills/<category>/<skill-name>/SKILL.md`
    that provide specialized workflows, tool integrations, and domain knowledge.
    Each SKILL.md contains YAML frontmatter and full instructions.
    Use the `description` field to identify relevant skills.
  fastskill_usage_instructions: |
    Use `fastskill search "query"` to search for skills semantically.
    Use `fastskill reindex` to update the skill index.
```

## Troubleshooting

### Common Issues

#### "Embedding not configured"
```bash
# Solution: Create .fastskill/config.yaml
cat > .fastskill/config.yaml << EOF
embedding:
  openai_base_url: "https://api.openai.com/v1"
  embedding_model: "text-embedding-3-small"
EOF
```

#### "OPENAI_API_KEY environment variable not set"
```bash
# Solution: Set API key
export OPENAI_API_KEY="sk-your-key-here"
```

#### "Permission denied" on database
```bash
# Solution: Check directory permissions
chmod 755 .claude/skills/
```

#### Rate limit exceeded
```bash
# Solution: Reduce concurrency and retry
fastskill reindex --max-concurrent 1 --skills-dir .claude/skills/
```

### Debug Mode

Enable detailed logging:

```bash
RUST_LOG=fastskill=debug fastskill reindex --skills-dir .claude/skills/
```

### Verification

Check if indexing succeeded:

```bash
# Check database exists
ls -la .claude/skills/.fastskill/index.db

# Test search
fastskill --skills-dir .claude/skills/ search "test" --embedding false
```

## Advanced Usage

### Custom Embedding Models

Use different OpenAI models:

```yaml
embedding:
  openai_base_url: "https://api.openai.com/v1"
  embedding_model: "text-embedding-3-large"  # Higher accuracy, higher cost
```

### Multiple Directories

Index skills from multiple locations:

```bash
# Index primary skills
fastskill reindex --skills-dir .claude/skills/

# Index additional skills
fastskill reindex --skills-dir ./custom-skills/
```

### Automated Reindex

Add to CI/CD pipeline:

```yaml
# .github/workflows/reindex-skills.yml
name: Reindex Skills Index
on:
  push:
    paths:
      - '.claude/skills/**'
jobs:
  reindex:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up FastSkill
        run: cargo install fastskill --path tools/fastskill/rust/
      - name: Reindex skills
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: fastskill reindex --skills-dir .claude/skills/
```

## Related Commands

### Search Command
Use indexed skills for semantic search:

```bash
fastskill search "process documents" --skills-dir .claude/skills/
```

### List Skills
View indexed skills without search:

```bash
# Use Rust library
# Or use CLI to list skills
fastskill list --skills-dir .claude/skills/
```

The reindex command is the foundation of FastSkill's semantic search capabilities, transforming static skill definitions into searchable, semantically-aware knowledge base.
